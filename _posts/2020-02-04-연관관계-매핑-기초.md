---
title: "ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ"
categories:
  - Programing
tags:
  - JPA
toc: true
toc_sticky: true
date: 2020-02-04 22:20:00+09:00 
last_modified_at: 2020-02-04 22:20:00+09:00
excerpt: Entity ê°„ì— ì—°ê´€ê´€ê³„ì— ëŒ€í•´ì„œ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ ë³¸ë‹¤. ê¸°ì´ˆì—ì„œëŠ” ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—
         ëŒ€í•´ì„œ ì„¤ëª…í•˜ê³  ì—°ê´€ê´€ê³„ ë§¤í•‘ì‹œì— ì£¼ì˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì„ ì•Œì•„ë³´ì.
---

## ë“¤ì–´ê°€ë©°
í•´ë‹¹ ê¸€ì€ ìë°” ORM í‘œì¤€ í”„ë¡œê·¸ë˜ë°ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.

Entity ê°„ì— ì—°ê´€ê´€ê³„ì— ëŒ€í•´ì„œ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ ë³¸ë‹¤. ê¸°ì´ˆì—ì„œëŠ” ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—
ëŒ€í•´ì„œ ì„¤ëª…í•˜ê³  ì—°ê´€ê´€ê³„ ë§¤í•‘ì‹œì— ì£¼ì˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì„ ì•Œì•„ë³´ì.

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„
- ì°¸ì¡°ë¥¼ í†µí•œ ì—°ê´€ê´€ê³„ëŠ” ì–¸ì œë‚˜ ë‹¨ë°©í–¥ìœ¼ë¡œë§Œ ì„¤ì • ëœë‹¤.
- ê°ì²´ëŠ” ì°¸ì¡°(ì£¼ì†Œ)ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤.
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì€ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•´ì„œ í•´ë‹¹ ì—”í‹°í‹°ë¥¼ íƒìƒ‰í•˜ëŠ” ê±¸ ì˜ë¯¸í•œë‹¤.
  - `member.getTeam()` ê°ì²´ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ë¥¼ íƒìƒ‰

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "member_id")
    private Long id;
    ...
    // ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •
    @ManyToOne
    @JoinColumn(name = "team_id")
    private Team team;
    ...
}

@Entity
public class Team {
    @Id
    @GeneratedValue
    @Column(name = "team_id")
    private Long id;
    ...
}
```  
  
### @JoinColumn
- ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘í•  ë•Œ ì‚¬ìš©í•˜ë©°, ìƒëµ ê°€ëŠ¥í•˜ë‹¤.
- @JoinColumnì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²½ìš° í•„ë“œëª… + '_' + ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸í‚¤ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ì™¸ë˜í‚¤ê°€ ìë™ ìƒì„± ëœë‹¤.

```sql
    alter table member 
       add constraint FKa04a95gj3stpfpgfofmg3f694 
       foreign key (team_team_id) 
       references team
```

### @ManyToOne
- ë‹¤ëŒ€ì¼(N:1) ê´€ê³„ì¼ë•Œ ì‚¬ìš©
- ì—¬ëŸ¬ ë©¤ë²„ê°€ í•œ íŒ€ì— ì†í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•œë‹¤ë©´, ì—¬ëŸ¬ ë©¤ë²„ëŠ” í•œ íŒ€ì— ì†í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë©¤ë²„ìª½ì´ Nì´ë˜ê³  íŒ€ìª½ì´ 1ì´ë¼ ë³¼ ìˆ˜ ìˆë‹¤.

| ì†ì„±         | ê¸°ëŠ¥                                               | ê¸°ë³¸ê°’                                               |
|--------------|----------------------------------------------------|------------------------------------------------------|
| optional     | falseë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤. | true                                                 |
| fetch        | ê¸€ë¡œë²Œ íŒ¨ì¹˜ ì „ëµì„ ì„¤ì •                            | @ManyToOne=FetchType.EAGER @OneToMany=FetchType.LAZY |
| cascade      | ì˜ì†ì„± ì „ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.                       | {}                                                   |
| targetEntity | ì—°ê´€ëœ ì—”í‹°í‹°ì˜ íƒ€ì… ì •ë³´ë¥¼ ì„¤ì •                   | void.class                                           |
	

## ì—°ê´€ê´€ê³„ ì‚¬ìš©
### ì €ì¥
- JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ì—°ê´€ëœ ëª¨ë“  ì—”í‹°í‹°ëŠ” ì˜ì† ìƒíƒœì—¬ì•¼ í•œë‹¤.
- ì˜ì†ìƒíƒœê°€ ì•„ë‹Œ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•´ì„œ ì €ì¥í•˜ë ¤ê³  í•˜ëŠ” ê²½ìš° ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

ì½”ë“œ
```java
@DataJpaTest
class testSave {
    @Autowired
    TestEntityManager em;

    @Test
    void testSave() {

        Team team = new Team();
        em.persist(team); // í•´ë‹¹ ë¶€ë¶„ì„ ì£¼ì„ìœ¼ë¡œ í•˜ëŠ” ê²½ìš° ì—ëŸ¬ ë°œ

        Member member = new Member();
        member.setTeam(team);
        em.persist(member);

        em.flush(); // flushë¥¼ í•´ì¤˜ì•¼ insert queryê°€ ì‹¤í–‰ ëœë‹¤.
    }
}
```

```sql
insert 
    into
        team
        (team_id) 
    values
        (?)
insert 
    into
        member
        (team_team_id, member_id) 
    values
        (?, ?)
        
```


### ì¡°íšŒ
- ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰

ì½”ë“œ

```java
Member member = em.find(Member.class, 1);
Team team = member.getTeam(); // ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
```

- ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì‚¬ìš©(JPQL)

ì½”ë“œ

```java
List<Member> resultList = em.getEntityManager()
                            .createQuery(jqpl, Member.class)
                            .setParameter("teamName", "íŒ€1")
                            .getResultList();

```

ì‹¤í–‰ ê²°ê³¼

```sql
    select
        member0_.member_id as member_i1_0_,
        member0_.string_status as string_s2_0_,
        member0_.team_team_id as team_tea3_0_ 
    from
        member member0_ 
    inner join
        team team1_ 
            on member0_.team_team_id=team1_.team_id 
    where
        team1_.name=?
```

### ì—°ê´€ëœ ì—”í‹°í‹° ì‚­ì œ
- ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê¸°ì¡´ì— ìˆë˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì œê±°í•˜ê³  ì‚­ì œí•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì™¸ë˜ í‚¤ ì œì•½ì¡°ê±´ìœ¼ë¡œ ì¸í•´, ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒ

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„
```java
@Entity
public class Team {
    @Id
    @GeneratedValue
    @Column(name = "team_id")
    private Long id;

    //==ì¶”ê°€==//
    @OneToMany(mappedBy="team")
    private List<Member> members = new ArrayList<Member>();
}
```

## ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- ë‘ ê°ì²´ ì—°ê´€ê´€ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì •í•´ì„œ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•˜ëŠ”ë° ì´ê²ƒì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)ì´ë¼ í•œë‹¤.
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê´€ê´€ê³„ì™€ ë§¤í•‘ë˜ê³  ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)í•  ìˆ˜ ìˆë‹¤. ë°˜ë©´ì— ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ í•  ìˆ˜ ìˆë‹¤.
- mappedBy ì†ì„±ì„ ì‚¬ìš©í•´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ê²°ì •
  - ì£¼ì¸ì€ mappedBy ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ì„ ì‚¬ìš©í•´ì„œ ì†ì„±ì˜ ê°’ìœ¼ë¡œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì§€ì •í•´ì•¼ í•œë‹¤.
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•œë‹¤ëŠ” ê²ƒì€ ì‚¬ì‹¤ ì™¸ë˜ í‚¤ ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ë‹¤.

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì˜ ì£¼ì˜ì 

ì½”ë“œ
```java
@Test
void ë¬¸ì œí™•ì¸() {
  // íšŒì› 1 ì €ì¥
  Member member1 = new Member();
  em.persist(member1);
  // íšŒì› 2 ì €ì¥
  Member member2 = new Member();
  em.persist(member2);

  Team team = new Team();
  // ì£¼ì¸ì´ ì•„ë‹Œ ê³³ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
  team.getMembers().add(member1);
  team.getMembers().add(member2);
  
  em.clear(); // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
  
  Member selectedMember = em.find(Member.class, member1.getId());
  System.out.println("team : " + selectedMember.getTeam());
}
```

ê²°ê³¼

```java
team : null
```

- ì—°ê´€ê´€ê³„ì— ì£¼ì¸ì´ ë˜ëŠ” memberì— teamì˜ ì™¸ë˜í‚¤ë¥¼ ì„¤ì •í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— team ê´€ë ¨ ì •ë³´ê°€ nullë¡œ insert ëœë‹¤.
- ê°ì²´ ê´€ì ì—ì„œ ì–‘ìª½ ë°©í–¥ì— ëª¨ë‘ ê°’ì„ ì…ë ¥í•´ì£¼ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì „í•˜ë‹¤.

ìˆ˜ì •ëœ ì½”ë“œ

```java
@Test
void ë¬¸ì œí™•ì¸() {
  
  Team team = new Team();
  em.persistAndFlush(team);

  // íšŒì› 1 ì €ì¥
  Member member1 = new Member();
  member1.setTeam(team);
  team.getMembers().add(member1);
  em.persistAndFlush(member1);

  // íšŒì› 2 ì €ì¥
  Member member2 = new Member();
  member2.setTeam(team);
  team.getMembers().add(member2);
  em.persistAndFlush(member2);

  em.clear(); // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°

  Member selectedMember = em.find(Member.class, member1.getId());
  System.out.println("team : " + selectedMember.getTeam());

}
```

ê²°ê³¼

```java
team : me.blog.jpa.model.Team@1ab9c735
```

## ë§ˆì¹˜ë©°
ì—”í‹°í‹° ê°„ì— ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì— ëŒ€í•´ì„œ ê°„ë‹¨í•˜ê²Œ ì•Œì•„ ë³´ì•˜ë‹¤.
ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ë§ì´ ì‹ ê²½ ì“¸ ë¶€ë¶„ì´ ì—†ì—ˆì§€ë§Œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ëŠ” ì—”í‹°í‹°ì— ì™¸ë˜í‚¤ë¡œ ì‚¬ìš© ë  ì°¸ì¡° ê°ì²´ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ì— ëŒ€í•´ì„œ í™•ì¸í•´ì£¼ì–´ì•¼ í•œë‹¤.

`cascade` ì˜µì…˜ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ í•´ê²°ì„ í•  ìˆ˜ ìˆì§€ë§Œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì‹œì— ì°¸ì¡°ê°€ ì–´ë–¤ ì‹ìœ¼ë¡œ ì´ë¤„ì§€ëŠ”ì§€
ë¬¸ì œì ì„ ë³´ê³  ì´í•´ í•˜ê³  ë„˜ì–´ê°€ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.ğŸ‘

- - -

- [JPA ë¦¬ë·°]({% post_url 2020-02-02-ìë°”-ORM-í‘œì¤€-í”„ë¡œê·¸ë˜ë°-ì±…-ë¦¬ë·° %}) ê¸€ ë³´ëŸ¬ê°€ê¸°

- - - 


 