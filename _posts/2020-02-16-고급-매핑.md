---
title: "ê³ ê¸‰ ë§¤í•‘"
categories:
  - Programing
tags:
  - JPA
toc: true
toc_sticky: true
date: 2020-02-16 18:46:00+09:00 
last_modified_at: 2020-02-16 18:46:00+09:00
excerpt: ì—”í‹°í‹° ê°„ì— ìƒì† ê´€ë ¨ ë§¤í•‘ì— ëŒ€í•´ì„œ ì•Œì•„ ë³¸ë‹¤.
---

## ë“¤ì–´ê°€ë©°
í•´ë‹¹ ê¸€ì€ ìë°” ORM í‘œì¤€ í”„ë¡œê·¸ë˜ë°ì„ ì •ë¦¬í•œ ê¸€ì…ë‹ˆë‹¤.

ìƒì† ê´€ê³„ ë§¤í•‘, `@MappedSuperclass`, ë³µí•©í‚¤ì™€ ì‹ë³„ê´€ê³„ ë§¤í•‘ì— ëŒ€í•´ì„œ ì•Œì•„ë³¸ë‹¤.


## ìƒì† ê´€ê³„ ë§¤í•‘
### ì¡°ì¸ ì „ëµ
- ê°ì²´ëŠ” íƒ€ì…ìœ¼ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆì§€ë§Œ í…Œì´ë¸”ì€ íƒ€ì…ì˜ ê°œë…ì´ ì—†ê¸°ì— typeì„ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ”
 ì»¬ëŸ¼(default = "DTYPE")ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```java
@Inheritance(strategy = InheritanceType.JOINED)
@Entity
@DiscriminatorColumn(name = "DTYPE")
public class Item {
    @Id @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private String name;
    private int price;
}


@Entity
@DiscriminatorValue("A")
public class Album extends Item {
    private String artist;
}

@Entity
@DiscriminatorValue("M")
public class Movie extends Item {
    private String director;
    private String actor;
}

```

```sql
    create table item (
       dtype varchar(31) not null,
        item_id bigint not null,
        name varchar(255),
        price integer not null,
        primary key (item_id)
    )
    
    create table album (
       artist varchar(255),
        item_id bigint not null,
        primary key (item_id)
    )
    
    create table movie (
       actor varchar(255),
        director varchar(255),
        item_id bigint not null,
        primary key (item_id)
    )    

```
#### @Inheritance(strategy = InheritanceType.JOINED)
- ìƒì† ë§¤í•‘ì€ ë¶€ëª¨ í´ë˜ìŠ¤ì— @Inheritanceë¥¼ ì‚¬ìš© í•´ì•¼ í•œë‹¤.
- ë§¤í•‘ ì „ëµì„ ì§€ì •í•´ì•¼ í•˜ëŠ”ë° ì¡°ì¸ ì „ëµì€ JOINEDë¥¼ ì‚¬ìš©í•œë‹¤.

#### @DiscriminatorColumn(name = "DTYPE")
- ë¶€ëª¨ í´ë˜ìŠ¤ì— êµ¬ë¶„ ì»¬ëŸ¼ì„ ì§€ì •í•œë‹¤.
- ì´ ì»¬ëŸ¼ìœ¼ë¡œ ì €ì¥ëœ ìì‹ í…Œì´ë¸”ì„ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.
- ê¸°ë³¸ê°’ì´ DTYPEì´ë‹¤.

#### @DiscriminatorValue("M")
- ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ êµ¬ë¶„ ì»¬ëŸ¼ì— ì…ë ¥í•  ê°’ì„ ì§€ì •í•œë‹¤.
- ê¸°ë³¸ê°’ì€ ì—”í‹°í‹° ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

#### ì¥ì 
- í…Œì´ë¸”ì´ ì •ê·œí™”ëœë‹¤.
- ì™¸ë˜ í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ì„ í™œìš©í•  ìˆ˜ ìˆë‹¤.
- ì €ì¥ê³µê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.

#### ë‹¨ì 
- ì¡°íšŒí•  ë•Œ ì¡°ì¸ì´ ë§ì´ ì‚¬ìš©ë˜ë¯€ë¡œ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆë‹¤.
- ì¡°íšŒ ì¿¼ë¦¬ê°€ ë³µì¡í•˜ë‹¤
- ë°ì´í„°ë¥¼ ë“±ë¡í•  INSERT SQLì„ ë‘ ë²ˆ ì‹¤í–‰í•œë‹¤.


```java
@Test
void insertTest() {
  Movie movie = new Movie();

  em.persistAndFlush(movie);
  em.clear();

  Movie result = em.find(Movie.class, movie.getId());
  System.out.println(result);
}
```

```sql
    insert 
    into
        item
        (name, price, dtype, item_id) 
    values
        (?, ?, 'M', ?)
        
    insert 
    into
        movie
        (actor, director, item_id) 
    values
        (?, ?, ?)
        
    select
        movie0_.item_id as item_id2_1_0_,
        movie0_1_.name as name3_1_0_,
        movie0_1_.price as price4_1_0_,
        movie0_.actor as actor1_5_0_,
        movie0_.director as director2_5_0_ 
    from
        movie movie0_ 
    inner join
        item movie0_1_ 
            on movie0_.item_id=movie0_1_.item_id 
    where
        movie0_.item_id=?                
```

### ë‹¨ì¼ í…Œì´ë¸” ì „ëµ
- InheritanceType.SINGLE_TABLEì„ ì‚¬ìš©í•œë‹¤.
- ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•´ì•¼ í•œë‹¤.

```java
@Data
@Inheritance(strategy = InheritanceType.SINGLE_TABLE) // í•´ë‹¹ ë¶€ë¶„ë§Œ ë³€ê²½
@Entity
@DiscriminatorColumn(name = "DTYPE")
public class Item {
    @Id @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private String name;
    private int price;
}
```

```sql
    create table item (
       dtype varchar(31) not null,
        item_id bigint not null,
        name varchar(255),
        price integer not null,
        artist varchar(255),
        actor varchar(255),
        director varchar(255),
        primary key (item_id)
    )
```
#### ì¥ì 
- ì¡°ì¸ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ë¹ ë¥´ë‹¤.
- ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœí•˜ë‹¤.
- ì¶”ê°€ì ì¸ í…Œì´ë¸” ìƒì„±ì´ ì—†ë‹¤.

#### ë‹¨ì 
- ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•´ì•¼ í•œë‹¤.
- ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆì–´, ìƒí™©ì— ë”°ë¼ ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.

```sql
    insert 
    into
        item
        (name, price, actor, director, dtype, item_id) 
    values
        (?, ?, ?, ?, 'M', ?)
        
    select
        movie0_.item_id as item_id2_0_0_,
        movie0_.name as name3_0_0_,
        movie0_.price as price4_0_0_,
        movie0_.actor as actor6_0_0_,
        movie0_.director as director7_0_0_ 
    from
        item movie0_ 
    where
        movie0_.item_id=? 
        and movie0_.dtype='M'
        
```

### êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ
- ì¶”ì²œí•˜ì§€ ì•ŠëŠ” ì „ëµ

#### ì¥ì 
- ì„œë¸Œ íƒ€ì…ì„ êµ¬ë¶„í•´ì„œ ì²˜ë¦¬í•  ë•Œ íš¨ê³¼ì ì´ë‹¤.
- not null ì œì•½ì¡°ê±´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

#### ë‹¨ì 
- ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ì„ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¬ë‹¤.(SQLì— UNIONì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.)
- ìì‹ í…Œì´ë¸”ì„ í†µí•©í•´ì„œ ì¿¼ë¦¬í•˜ê¸° ì–´ë µë‹¤.

## @MappedSuperclass
- ë¶€ëª¨ í´ë˜ìŠ¤ëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘í•˜ì§€ ì•Šê³  ë¶€ëª¨ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì—ê²Œ ë§¤í•‘ ì •ë³´ë§Œ ì œê³µí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
- @AttributeOverrides, @AttributeOverrideë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€ëª¨ë¡œë¶€í„° ë¬¼ë ¤ë°›ì€ ë§¤í•‘ ì •ë³´ë¥¼ ì¬ì •ì˜ ê°€ëŠ¥
- í…Œì´ë¸”ì— ë§¤í•‘ë˜ì§€ ì•Šê³  ìì‹ í´ë˜ìŠ¤ì— ì—”í‹°í‹°ì˜ ë§¤í•‘ ì •ë³´ë¥¼ ìƒì†í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- em.find()ë‚˜ JPQLì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
- ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ì¼ì€ ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ë§Œë“œëŠ” ê²ƒì„ ê¶Œì¥

```java
@MappedSuperclass
public abstract class AbstractEntity {
    @Id
    private Long id;

    private OffsetDateTime createdTime;
    private OffsetDateTime modifiedTime;
    private OffsetDateTime removedTime;
}

@Entity
public class Book extends AbstractEntity {
}


```

```sql
create table book (
       id bigint not null,
        created_time timestamp,
        modified_time timestamp,
        removed_time timestamp,
        primary key (id)
    )
```

- ë¶€ëª¨ë¡œ ë¶€í„° ìƒì† ë°›ì€ ê°’ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œëŠ” @AttributeOverridesë¥¼ ì´ìš©í•´ì„œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

```java
@Entity
@AttributeOverrides(value = {@AttributeOverride(name = "id", column = @Column(name = "book_id"))})
public class Book extends AbstractEntity {
    // Idì™€ time ìƒ
}
```

```sql
    
    create table book (
       book_id bigint not null, // idì—ì„œ book_idë¡œ ë³€
        created_time timestamp,
        modified_time timestamp,
        removed_time timestamp,
        primary key (book_id)
    )
```

## ë³µí•© í‚¤ì™€ ì‹ë³„ ê´€ê³„ ë§¤í•‘

### ì‹ë³„ê´€ê³„
- ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë‚´ë ¤ë°›ì•„ì„œ ìì‹ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ + ì™¸ë˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê´€ê³„
- ìì‹ í…Œì´ë¸”ë¡œ ë‚´ë ¤ê°ˆ ìˆ˜ë¡ ê¸°ë³¸ í‚¤ ì»¬ëŸ¼ì´ ëŠ˜ì–´ë‚˜ ì¡°ì¸ì‹œ ë³µì¡í•´ì§€ê³  ê¸°ë³¸í‚¤ ì¸ë±ìŠ¤ê°€ ë¶ˆí•„ìš”í•˜ê²Œ ì»¤ì§ˆ ìˆ˜ ìˆìŒ
- ìì—° í‚¤ ì»¬ëŸ¼ë“¤ë¡œ ë§Œë“¤ê²Œ ë˜ë©´ ë‚˜ì¤‘ì— ë¹„ì§€ë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì´ ë³€ê²½ë¨ì— ë”°ë¼ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŒ
- ì‹ë³„ ê´€ê³„ì˜ ê²½ìš° @GenerateValueë¥¼ ì‚¬ìš©í•˜ì§€ ëª» í•œë‹¤.

### ë¹„ì‹ë³„ ê´€ê³„
- ë¶€ëª¨ í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ë°›ì•„ì„œ ìì‹ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¡œë§Œ ì‚¬ìš©
- í•„ìˆ˜ì  ë¹„ì‹ë³„ ê´€ê³„
  - ì™¸ë˜ í‚¤ì— NULLì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ì—°ê´€ê´€ê³„ë¥¼ í•„ìˆ˜ì ìœ¼ë¡œ ë§ºì–´ì•¼ í•œë‹¤.
- ì„ íƒì  ë¹„ì‹ë³„ ê´€ê³„
  - ì™¸ë˜ í‚¤ì— NULLì„ í—ˆìš©í•œë‹¤. ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ì§€ ë§ì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

### @IdClass
- ì‹ë³„ì í´ë˜ìŠ¤ì˜ ì†ì„±ëª…ê³¼ ì—”í‹°í‹°ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì‹ë³„ìì˜ ì†ì„±ëª…ì´ ê°™ì•„ì•¼ í•œë‹¤.
  - Parent.id1ê³¼ ParentId.id1
- Serializable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- equals, hashCodeë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.
- ì‹ë³„ì í´ë˜ìŠ¤ëŠ” publicì´ì–´ì•¼ í•œë‹¤.

```java
@Entity
@IdClass(ParentId.class)
public class Parent {
    @Id
    private String id1;

    @Id
    private String id2;
}

public class ParentId implements Serializable {
    private Long id1;
    private Long id2;
}
```

```sql
    create table parent (
       id1 varchar(255) not null,
        id2 varchar(255) not null,
        primary key (id1, id2)
    )
```

### @EmbeddedId
- @Embeddable ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ì–´ì•¼ í•œë‹¤.
- Serializable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- equals, hashCodeë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- ê¸°ë³¸ ìƒì„±ìê°€ ìˆì–´ì•¼ í•œë‹¤.
- ì‹ë³„ì í´ë˜ìŠ¤ëŠ” publicì´ì–´ì•¼ í•œë‹¤.
- ì‹ë³„ ê´€ê³„ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° @MapsIdë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```java
@Entity
public class Parent {
    @EmbeddedId
    private ParentId id;
}

@Embeddable
public class ParentId implements Serializable {
    private Long id1;
    private Long id2;
}
```

```sql
    create table parent (
       id1 varchar(255) not null,
        id2 varchar(255) not null,
        primary key (id1, id2)
    )
```
## ë§ˆì¹˜ë©°
ìƒì† ê´€ê³„ì¼ ë•Œ ë§¤í•‘ì„ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ë‹¤. 
ì‹¤ë¬´ì—ì„œë„ ìƒì†ê´€ê³„ì¼ ë•Œ `JOINED`ì™€ `SINGLE_TABLE` ì¤‘ ì— ë¬´ì—‡ì„ ì“¸ì§€ëŠ” ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ
ë³µì¡ë„ë¥¼ ê³ ë ¤í•´ë³¼ ë•ŒëŠ” `SINGLE_TABLE`ì´ ë‚®ì•„ ì ìš©í•˜ê¸°ì—ëŠ” ì‰¬ì›Œ ë³´ì¸ë‹¤ê³  ìƒê°í•œë‹¤.

`@MappedSuperClass` ì–´ë…¸í…Œì´ì…˜ì€ ì‹¤ë¬´ì—ì„œë„ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì˜ ì„¤ê³„ëœ ì—”í‹°í‹°ì˜ ê²½ìš°
ìƒë‹¹íˆ ë§ì€ ë¶€ëª¨ë¡œ ë¶€í„° ë¼ì´í”„ ì‚¬ì´í´ê¹Œì§€ ê´€ë¦¬ë  ìˆ˜ ìˆê²Œ ì‚¬ìš©ë˜ë‹ˆ ì˜ ê¸°ì–µí•´ë‘ê¸°ë¥¼ ì¶”ì²œí•œë‹¤.ğŸ‘
- - -

- [JPA ë¦¬ë·°]({% post_url 2020-02-02-ìë°”-ORM-í‘œì¤€-í”„ë¡œê·¸ë˜ë°-ì±…-ë¦¬ë·° %}) ê¸€ ë³´ëŸ¬ê°€ê¸°

- - - 


 